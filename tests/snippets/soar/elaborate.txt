---input---
sp {elaborate*AddTwoInts
   (state <s> ^name test)
   (<s> ^AddTwoInts <ati>)
   (<ati> ^a <a>
       ^b <a>)
-->
   (<ati> ^sum (+ <a> <b>))
}

---tokens---
'sp'          Keyword.Reserved
' '           Text.Whitespace
'{'           Punctuation
'elaborate*AddTwoInts' Name.Function
'\n   '       Text.Whitespace
'('           Punctuation
'state'       Keyword.Reserved
' '           Text.Whitespace
'<s>'         Name.Variable
' '           Text.Whitespace
'^name'       Name.Variable
' '           Text.Whitespace
'test'        Literal
')'           Punctuation
'\n   '       Text.Whitespace
'('           Punctuation
'<s>'         Name.Variable
' '           Text.Whitespace
'^AddTwoInts' Name.Variable
' '           Text.Whitespace
'<ati>'       Name.Variable
')'           Punctuation
'\n   '       Text.Whitespace
'('           Punctuation
'<ati>'       Name.Variable
' '           Text.Whitespace
'^a'          Name.Variable
' '           Text.Whitespace
'<a>'         Name.Variable
'\n       '   Text.Whitespace
'^b'          Name.Variable
' '           Text.Whitespace
'<a>'         Name.Variable
')'           Punctuation
'\n'          Text.Whitespace

'-->'         Punctuation
'\n   '       Text.Whitespace
'('           Punctuation
'<ati>'       Name.Variable
' '           Text.Whitespace
'^sum'        Name.Variable
' '           Text.Whitespace
'('           Punctuation
'+'           Operator
' '           Text.Whitespace
'<a>'         Name.Variable
' '           Text.Whitespace
'<b>'         Name.Variable
')'           Punctuation
')'           Punctuation
'\n'          Text.Whitespace

'}'           Punctuation
'\n'          Text.Whitespace
